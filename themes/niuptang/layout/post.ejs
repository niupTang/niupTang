<article class="post-detail">
    <header class="post-header">
        <h1 class="post-title">
            <%= page.title %>
        </h1>
        <div class="post-meta">
            <time datetime="<%= date(page.date, 'YYYY-MM-DD') %>">
                ğŸ“… <%= date(page.date, 'YYYYå¹´MMæœˆDDæ—¥' ) %>
            </time>
            <% if (page.categories && page.categories.length> 0) { %>
                <span class="post-category">
                    ğŸ“ <% page.categories.each(function(cat) { %>
                        <a href="<%- url_for(cat.path) %>">
                            <%= cat.name %>
                        </a>
                        <% }); %>
                </span>
                <% } %>
        </div>
    </header>

    <div class="post-content">
        <%- page.content %>
    </div>

    <% if (page.tags && page.tags.length> 0) { %>
        <div class="post-tags">
            ğŸ·ï¸
            <% page.tags.each(function(tag) { %>
                <a href="<%- url_for(tag.path) %>" class="tag">
                    <%= tag.name %>
                </a>
                <% }); %>
        </div>
        <% } %>

            <!-- å‘å¸ƒåˆ°å…¬ä¼—å·æŒ‰é’® -->
            <div class="wechat-publish-section"
                style="margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #07c160 0%, #06ad56 100%); border-radius: 12px; text-align: center;">
                <button id="publishBtn" onclick="publishToWechat()" style="
            background: white;
            color: #07c160;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        ">
                    ğŸ“¤ å‘å¸ƒåˆ°å¾®ä¿¡å…¬ä¼—å·
                </button>
                <p id="publishStatus" style="color: white; margin-top: 15px; font-size: 14px; display: none;"></p>
            </div>

            <script>
    async function publishToWechat() {
        const btn = document.getElementById('publishBtn');
        const status = document.getElementById('publishStatus');
        const articlePath = 'source/_posts/<%= page.source.replace("_posts/", "") %>';
        
        btn.disabled = true;
        btn.textContent = 'â³ æ­£åœ¨å‘å¸ƒ...';
        status.style.display = 'block';
        status.textContent = 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡å¹¶åˆ›å»ºè‰ç¨¿...';
        
        try {
            const res = await fetch('http://localhost:8790/api/publish', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ articlePath })
            });
            
            const data = await res.json();
            
            if (data.success) {
                btn.textContent = 'âœ… å‘å¸ƒæˆåŠŸï¼';
                btn.style.background = '#07c160';
                btn.style.color = 'white';
                status.textContent = 'æ–‡ç« å·²ä¿å­˜åˆ°å…¬ä¼—å·è‰ç¨¿ç®±ï¼Œè¯·ç™»å½•å…¬ä¼—å·åå°æŸ¥çœ‹';
            } else {
                throw new Error(data.error || 'å‘å¸ƒå¤±è´¥');
            }
        } catch (error) {
            btn.textContent = 'âŒ å‘å¸ƒå¤±è´¥';
            btn.style.background = '#ff4d4f';
            btn.style.color = 'white';
            status.textContent = 'é”™è¯¯: ' + error.message + ' (è¯·ç¡®ä¿ API æœåŠ¡å·²å¯åŠ¨: npm run api)';
            
            setTimeout(() => {
                btn.disabled = false;
                btn.textContent = 'ğŸ“¤ é‡è¯•å‘å¸ƒ';
                btn.style.background = 'white';
                btn.style.color = '#07c160';
            }, 3000);
        }
    }
            </script>

            <nav class="post-nav">
                <% if (page.prev) { %>
                    <a href="<%- url_for(page.prev.path) %>" class="prev-post">
                        â† <%= page.prev.title %>
                    </a>
                    <% } %>
                        <% if (page.next) { %>
                            <a href="<%- url_for(page.next.path) %>" class="next-post">
                                <%= page.next.title %> â†’
                            </a>
                            <% } %>
            </nav>
</article>